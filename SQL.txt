-- 1. Retrieve the average cost of all bookings made on the airline.
SELECT AVG(cost)
FROM Bookings;

-- 2. Retrieve the total number of flights that have departed from each origin airport.
SELECT COUNT (flight_number)
FROM Flights
Group BY (origin);

-- 3. Retrieve the total number of flights that have arrived at each destination airport.
SELECT COUNT (flight_number)
FROM FLights
Group BY (destination);

-- 4. Retrieve the total number of passengers who have booked flights departing from each origin airport.
SELECT origin, COUNT (passenger_id) AS "Total number of passengers"
FROM Bookings
INNER JOIN Flights F
ON Bookings.flight_number = F.Flight_number
GROUP BY origin;

-- 5. Retrieve the average cost of flights departing from each origin airport.
SELECT origin, AVG(cost) AS "Average"
FROM Bookings
INNER JOIN Flights F
ON Bookings.Flight_number=F.Flight_number
GROUP BY origin;

-- 6. Retrieve the total number of passengers who have booked flights departing from each origin airport,
-- but only for airports with an average cost per passenger of less than $200.
SELECT origin, COUNT (passenger_id), AVG(cost) AS "Average"
FROM Bookings
INNER JOIN Flights F
ON Bookings.flight_number = F.Flight_number
GROUP BY origin
HAVING AVG(cost) < 200
ORDER BY "Average" DESC;

-- 7. Retrieve the total revenue generated by the airline, grouped by month.

-- SELECT SUM (cost) AS "Total revenue", booking_date
-- FROM Bookings
-- GROUP BY booking_date
-- HAVING booking_date BETWEEN '2023-01-01' AND '2023-01-31';

-- SELECT SUM (cost) AS "Total revenue"
-- FROM Bookings
-- Where booking_date BETWEEN '2023-01-01' AND '2023-01-31';

SELECT TO_CHAR(booking_date, 'Month') AS Month,
SUM (cost) AS "Total revenue"
FROM Bookings
GROUP BY MONTH;

-- 8. Retrieve the average number of passengers per flight for each origin airport,
-- but only for airports that have more than 5 departures.
SELECT ORIGIN, AVG(PASSENGER_NUMBER) as AVG_PASSENGER_PER_FLIGHT
FROM (
    SELECT FLIGHT_NUMBER, COUNT(PASSENGER_ID) AS PASSENGER_NUMBER
	FROM BOOKINGS
	GROUP BY FLIGHT_NUMBER ) as PASSENGER_PER_FLIGHT

INNER JOIN FLIGHTS F ON PASSENGER_PER_FLIGHT.FLIGHT_NUMBER = F.FLIGHT_NUMBER
GROUP BY ORIGIN HAVING COUNT(ORIGIN) = 2;

-- 9. Retrieve the top 10 most popular destination airports,
-- based on the total number of passengers who have booked flights to each destination.
SELECT DESTINATION, COUNT(PASSENGER_ID) as TOTAL_PASSENGERS
FROM BOOKINGS
INNER JOIN FLIGHTS F ON BOOKINGS.FLIGHT_NUMBER = F.FLIGHT_NUMBER
GROUP BY DESTINATION  
ORDER BY TOTAL_PASSENGERS DESC 
LIMIT 10;

-- 10. Retrieve the origin and destination airports that have the highest average cost per passenger,,
-- but only for flights that depart from an airport with more than 5 departures.
SELECT COUNT(ORIGIN) AS TOTAL_NUMBER_OF_FLIGHTS_BY_ORIGIN,
ORIGIN, AVG(COST) AS AVERAGE_COST
FROM BOOKINGS
INNER JOIN FLIGHTS F ON BOOKINGS.FLIGHT_NUMBER = F.FLIGHT_NUMBER
GROUP BY ORIGIN
HAVING COUNT(ORIGIN) > 4
ORDER BY AVERAGE_COST DESC;